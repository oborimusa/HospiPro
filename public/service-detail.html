<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title id="pageTitle">Service Detail | HospiTour</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root{
            --gold: #c9a44c;
            --brown: #3b2f2f;
            --light-brown: #5a4a4a;
            --cream: #f7f5f1;
            --light-cream: #fefdf9;
        }
        
        body{
            font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; 
            background: var(--cream); 
            color: var(--brown);
        }
        
        .navbar-custom{
            background: var(--brown);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .hero-profile{
            background: linear-gradient(135deg, var(--brown) 0%, var(--light-brown) 100%);
            padding: 60px 0 40px;
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .hero-profile::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 300px;
            height: 300px;
            background: rgba(201, 164, 76, 0.1);
            border-radius: 50%;
            transform: translate(30%, -30%);
        }
        
        .logo-lg{
            width: 140px;
            height: 140px;
            object-fit: cover;
            border-radius: 16px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        
        .btn-gold{
            background: var(--gold); 
            color: var(--brown); 
            border: none;
            font-weight: 600;
            padding: 12px 24px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .btn-gold:hover{
            background: #b8943a;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(201, 164, 76, 0.3);
        }
        
        .btn-outline-gold {
            border: 1px solid var(--gold);
            color: var(--gold);
            background: transparent;
        }
        
        .btn-outline-gold:hover {
            background: var(--gold);
            color: white;
        }
        
        .text-brown {
            color: var(--brown);
        }
        
        .text-gold {
            color: var(--gold);
        }
        
        .bg-brown {
            background-color: var(--brown);
        }
        
        .bg-gold {
            background-color: var(--gold);
        }
        
        .card {
            border-radius: 12px;
            border: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .service-card {
            border-radius: 10px;
            padding: 20px;
            height: 100%;
            border-left: 4px solid var(--gold);
            transition: all 0.3s ease;
        }
        
        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .stats-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        
        .stats-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0;
            color: var(--brown);
        }
        
        .stats-label {
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        .section-title {
            position: relative;
            padding-bottom: 12px;
            margin-bottom: 25px;
        }
        
        .section-title:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background: var(--gold);
            border-radius: 3px;
        }
        
        .rating-stars {
            color: var(--gold);
        }
        
        .feature-list {
            list-style: none;
            padding: 0;
        }
        
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .feature-list li:last-child {
            border-bottom: none;
        }
        
        .feature-list i {
            color: var(--gold);
            margin-right: 10px;
        }
        
        .tag {
            display: inline-block;
            background: rgba(201, 164, 76, 0.1);
            color: var(--brown);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            margin-right: 8px;
            margin-bottom: 8px;
        }
        
        @media (max-width: 768px) {
            .logo-lg {
                width: 100px;
                height: 100px;
            }
            
            .hero-profile {
                padding: 40px 0 30px;
            }
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-custom">
        <div class="container">
            <a class="navbar-brand text-white d-flex align-items-center gap-2" href="index.html">
                <img src="img/logo1.png" alt="HospiPro" style="width:30px;">
                <strong class="text-white">HospiTour</strong>
            </a>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link text-white d-flex align-items-center" href="services.html">
                            <i class="fas fa-arrow-left me-2"></i>Back to Marketplace
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="hero-profile">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-2 text-center text-md-start">
                    <img id="providerLogo" src="img/default-logo.png" alt="Provider Logo" class="logo-lg">
                </div>
                <div class="col-md-6 mt-3 mt-md-0">
                    <h1 id="providerName" class="fw-bold mb-2">Loading Professional...</h1>
                    <p class="lead mb-2" id="providerCity">City, Location</p>
                    <div class="d-flex align-items-center flex-wrap gap-3">
                        <span class="rating-stars" id="providerRating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <span class="ms-1">5.0</span>
                        </span>
                        <span class="text-white-50">|</span>
                        <span><i class="fas fa-check-circle me-1"></i>Verified Professional</span>
                        <span class="text-white-50">|</span>
                        <span><i class="fas fa-clock me-1"></i>Responds within 2 hours</span>
                    </div>
                </div>
                <div class="col-md-4 mt-4 mt-md-0">
                    <div class="row text-center">
                        <div class="col-4">
                            <div class="stats-card">
                                <p class="stats-number" id="completedJobs">50+</p>
                                <p class="stats-label">Jobs Done</p>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="stats-card">
                                <p class="stats-number" id="responseRate">98%</p>
                                <p class="stats-label">Response Rate</p>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="stats-card">
                                <p class="stats-number" id="experience">5+</p>
                                <p class="stats-label">Years Exp</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <main class="container py-5">
        <div class="row g-5">
            
            <div class="col-lg-8">
                <div class="card p-4 mb-5">
                    <h3 class="section-title">About Us</h3>
                    <p id="providerDescription" class="mb-0">Detailed profile description goes here...</p>
                </div>

                <h3 class="section-title">Services Offered</h3>
                <div id="serviceList" class="row g-4">
                    <div class="col-12 text-muted">Loading services...</div>
                </div>
                
                <div class="card p-4 mt-5">
                    <h3 class="section-title">Specializations</h3>
                    <div id="specializations" class="d-flex flex-wrap gap-2">
                        <span class="tag">Wedding Planning</span>
                        <span class="tag">Corporate Events</span>
                        <span class="tag">Catering</span>
                        <span class="tag">Venue Decoration</span>
                    </div>
                </div>
                
                <div class="card p-4 mt-5">
                    <h3 class="section-title">What's Included</h3>
                    <ul class="feature-list">
                        <li><i class="fas fa-check-circle"></i>Initial consultation and planning session</li>
                        <li><i class="fas fa-check-circle"></i>Detailed proposal with timeline and budget</li>
                        <li><i class="fas fa-check-circle"></i>Vendor coordination and management</li>
                        <li><i class="fas fa-check-circle"></i>On-site event supervision</li>
                        <li><i class="fas fa-check-circle"></i>Post-event follow-up and support</li>
                    </ul>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="card p-4 shadow-sm sticky-top" style="top: 20px;">
                    <h4 class="mb-3 text-brown">Book This Professional</h4>
                    <form id="bookingForm">
                        <div class="mb-3">
                            <label for="clientName" class="form-label small fw-bold">Your Name</label>
                            <input type="text" class="form-control" id="clientName" required>
                        </div>
                        <div class="mb-3">
                            <label for="clientEmail" class="form-label small fw-bold">Your Email</label>
                            <input type="email" class="form-control" id="clientEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="clientPhone" class="form-label small fw-bold">Phone Number</label>
                            <input type="tel" class="form-control" id="clientPhone">
                        </div>
                        <div class="mb-3">
                            <label for="bookingDate" class="form-label small fw-bold">Preferred Date</label>
                            <input type="date" class="form-control" id="bookingDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="serviceType" class="form-label small fw-bold">Service Type</label>
                            <select class="form-select" id="serviceType">
                                <option value="">Select a service</option>
                                <option value="wedding">Wedding Planning</option>
                                <option value="corporate">Corporate Event</option>
                                <option value="social">Social Gathering</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="bookingDetails" class="form-label small fw-bold">Event/Service Details</label>
                            <textarea class="form-control" id="bookingDetails" rows="3" placeholder="Tell us about your event, guests, and specific needs." required></textarea>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-gold">
                                <i class="fas fa-paper-plane me-2"></i>Send Booking Request
                            </button>
                            <button type="button" class="btn btn-outline-gold">
                                <i class="fas fa-comment me-2"></i>Send Message
                            </button>
                        </div>
                        <div id="bookingMessage" class="mt-3 small text-center"></div>
                    </form>
                </div>
                
                <div class="card p-4 mt-4">
                    <h5 class="mb-3">Why Choose Us?</h5>
                    <div class="d-flex align-items-start mb-3">
                        <i class="fas fa-award text-gold mt-1 me-3"></i>
                        <div>
                            <h6 class="mb-1">Award-Winning Service</h6>
                            <p class="small text-muted mb-0">Recognized for excellence in event planning</p>
                        </div>
                    </div>
                    <div class="d-flex align-items-start mb-3">
                        <i class="fas fa-shield-alt text-gold mt-1 me-3"></i>
                        <div>
                            <h6 class="mb-1">Fully Insured</h6>
                            <p class="small text-muted mb-0">Comprehensive liability coverage</p>
                        </div>
                    </div>
                    <div class="d-flex align-items-start">
                        <i class="fas fa-handshake text-gold mt-1 me-3"></i>
                        <div>
                            <h6 class="mb-1">Trusted Partner</h6>
                            <p class="small text-muted mb-0">Preferred vendor for top venues</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-light py-4 mt-5 border-top">
        <div class="container text-center small text-muted">
            &copy; <span id="year"></span> HospiTour. All rights reserved.
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, getDoc, doc, query, where, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // 1. CONFIG: Replace with your project's config
        const firebaseConfig = {
            apiKey: "AIzaSyCgDu8Pd2IcvIWRYnxnASoNvrxjC3rJ3Ok", 
            authDomain: "hospipro-86b8d.firebaseapp.com",
            projectId: "hospipro-86b8d",
            storageBucket: "hospipro-86b8d.firebasestorage.app",
            messagingSenderId: "801856698977",
            appId: "1:801856698977:web:05562aaf88584d2af0c820",
        };

        // 2. INIT
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // 3. UI Elements
        const providerNameEl = document.getElementById('providerName');
        const providerCityEl = document.getElementById('providerCity');
        const providerLogoEl = document.getElementById('providerLogo');
        const providerDescriptionEl = document.getElementById('providerDescription');
        const serviceListEl = document.getElementById('serviceList');
        const pageTitleEl = document.getElementById('pageTitle');
        const bookingForm = document.getElementById('bookingForm');
        const bookingMessageEl = document.getElementById('bookingMessage');
        
        let providerUid = null; // To store the professional's UID for booking submission

        // 4. DATA FETCHING
        async function loadProviderDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const providerDocId = urlParams.get('id'); // This is the Firestore document ID from 'providers' collection
            
            if (!providerDocId) {
                providerNameEl.textContent = "Error: Provider ID Missing.";
                return;
            }

            try {
                // Fetch Provider Profile
                const providerRef = doc(db, 'providers', providerDocId);
                const providerSnap = await getDoc(providerRef);

                if (!providerSnap.exists()) {
                    providerNameEl.textContent = "Error: Provider Not Found.";
                    return;
                }

                const providerData = providerSnap.data();
                providerUid = providerData.uid; // Save UID for booking submission

                // Update UI with Profile Data
                pageTitleEl.textContent = `${providerData.name} | HospiTour`;
                providerNameEl.textContent = providerData.name || 'Service Professional';
                providerCityEl.textContent = providerData.city || 'Location Not Specified';
                providerLogoEl.src = providerData.logoUrl || 'img/default-logo.png';
                providerDescriptionEl.textContent = providerData.description || 'This professional is ready to take on your service needs.';
                
                // Load Services offered by this provider
                await loadProviderServices(providerData.uid);

            } catch (error) {
                console.error("Error loading provider details:", error);
                providerNameEl.textContent = "Error loading data.";
            }
        }
        
        async function loadProviderServices(uid) {
            serviceListEl.innerHTML = `<div class="col-12 text-muted">Fetching service catalog...</div>`;
            try {
                const servicesRef = collection(db, 'services');
                const q = query(servicesRef, where('providerUid', '==', uid));
                const snapshot = await getDocs(q);
                
                serviceListEl.innerHTML = '';
                if (snapshot.empty) {
                    serviceListEl.innerHTML = `<div class="col-12 text-muted">No services listed yet.</div>`;
                    return;
                }

                snapshot.forEach(docSnap => {
                    const s = docSnap.data();
                    const col = document.createElement('div');
                    col.className = 'col-md-6';
                    col.innerHTML = `
                        <div class="service-card">
                            <h6 class="fw-bold text-brown">${s.title}</h6>
                            <div class="small text-muted mb-2">${s.category} • ${s.price || 'Price Upon Request'}</div>
                            <p class="small">${s.description.substring(0, 100) + '...'}</p>
                            <div class="mt-3">
                                <span class="badge bg-gold text-brown">Popular</span>
                            </div>
                        </div>
                    `;
                    serviceListEl.appendChild(col);
                });

            } catch (error) {
                console.error("Error loading services:", error);
                serviceListEl.innerHTML = `<div class="col-12 text-danger">Could not load services.</div>`;
            }
        }

        // 5. BOOKING SUBMISSION HANDLER
        bookingForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            bookingMessageEl.textContent = '';
            
            if (!providerUid) {
                bookingMessageEl.innerHTML = `<span class="text-danger">Error: Cannot submit booking without provider ID.</span>`;
                return;
            }

            const clientName = document.getElementById('clientName').value;
            const clientEmail = document.getElementById('clientEmail').value;
            const clientPhone = document.getElementById('clientPhone').value;
            const bookingDate = document.getElementById('bookingDate').value;
            const serviceType = document.getElementById('serviceType').value;
            const bookingDetails = document.getElementById('bookingDetails').value;

            try {
                // Submit request to a 'bookings' collection
                await addDoc(collection(db, 'bookings'), {
                    providerUid: providerUid,
                    clientName: clientName,
                    clientEmail: clientEmail,
                    clientPhone: clientPhone,
                    serviceType: serviceType,
                    preferredDate: new Date(bookingDate),
                    details: bookingDetails,
                    status: 'Pending',
                    createdAt: new Date(),
                });

                bookingMessageEl.innerHTML = `<span class="text-success">
                    <i class="fas fa-check-circle me-1"></i>
                    Request sent successfully! The professional will contact you soon.
                </span>`;
                bookingForm.reset();

            } catch (error) {
                console.error("Booking submission error:", error);
                bookingMessageEl.innerHTML = `<span class="text-danger">
                    <i class="fas fa-exclamation-circle me-1"></i>
                    Failed to send request. Please try again.
                </span>`;
            }
        });

        // Initial load
        loadProviderDetails();
        document.getElementById('year').textContent = new Date().getFullYear();
    </script>
</body>
</html>