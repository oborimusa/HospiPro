<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Service Marketplace | HospiPro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root{
            --gold: #c9a44c;
            --brown: #3b2f2f;
        }
        body{font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:#f7f5f1; color:#222;}
        .navbar-custom{background:var(--brown);}
        .hero-section{background-color: #fff; padding: 40px 0; border-bottom: 1px solid #eee;}
        .service-card{height: 100%; border-radius: 12px; transition: transform 0.2s; cursor: pointer;}
        .service-card:hover{transform: translateY(-3px); box-shadow: 0 6px 15px rgba(0,0,0,0.1);}
        .logo-preview-sm{width:40px;height:40px;object-fit:cover;border-radius:8px;margin-right:10px;}
        .btn-gold{background:var(--gold); color:var(--brown); border:none;}
        .btn-gold:hover{opacity:.95;}
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-custom">
        <div class="container">
            <a class="navbar-brand text-white d-flex align-items-center gap-2" href="index.html">
                <img src="img/logo1.png" alt="HospiPro" style="width:30px;">
                <strong class="text-white">HospiPro</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link text-white" href="index.html#features">Features</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white active" aria-current="page" href="services.html">Services Marketplace</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="pricing.html">Pricing</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="login.html">Login</a>
                    </li>
                    <li class="nav-item ms-lg-3">
                        <a class="btn btn-gold" href="signup.html">Sign Up Free</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="hero-section">
        <div class="container">
            <h1 class="text-brown fw-bold">Find Local Service Professionals</h1>
            <p class="lead text-muted">Browse verified caterers, event planners, staffing agencies, and more.</p>
            <div class="row">
                <div class="col-md-6">
                    <input type="text" id="searchBox" class="form-control" placeholder="Search by service, name, or category...">
                </div>
            </div>
        </div>
    </div>

    <main class="container py-5">
        <div id="serviceListings" class="row g-4">
            <div class="col-12 text-center text-muted">Loading available professionals...</div>
        </div>
        <div id="noResults" class="col-12 text-center text-muted mt-5" style="display: none;">No professionals matched your search.</div>
    </main>

    <footer class="bg-light py-4 mt-5 border-top">
        <div class="container text-center small text-muted">
            &copy; <span id="year"></span> HospiPro. All rights reserved.
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // 1. CONFIG: Replace with your project's config
        const firebaseConfig = {
            apiKey: "AIzaSyCgDu8Pd2IcvIWRYnxnASoNvrxjC3rJ3Ok", 
            authDomain: "hospipro-86b8d.firebaseapp.com",
            projectId: "hospipro-86b8d",
            storageBucket: "hospipro-86b8d.firebasestorage.app",
            messagingSenderId: "801856698977",
            appId: "1:801856698977:web:05562aaf88584d2af0c820",
        };

        // 2. INIT
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // 3. UI Elements
        const serviceListingsEl = document.getElementById('serviceListings');
        const searchBox = document.getElementById('searchBox');
        const noResultsEl = document.getElementById('noResults');
        let allProfessionals = [];

        // 4. DATA FETCHING
        async function fetchProfessionals() {
            serviceListingsEl.innerHTML = `<div class="col-12 text-center text-muted">Loading available professionals...</div>`;
            try {
                // Fetch documents from the 'providers' collection where the accountType is 'professional'
                // NOTE: We rely on the signup.html logic to create this field in the 'users' or 'providers' collection
                const providersRef = collection(db, 'providers'); // Assuming you use 'providers' for professional data
                const q = query(providersRef); // Simple fetch all for MVP, will filter client-side

                const snapshot = await getDocs(q);
                allProfessionals = [];
                snapshot.forEach(docSnap => {
                    const data = docSnap.data();
                    // Filter to only include profiles that look complete enough to list
                    if (data.name && data.logoUrl) { 
                        allProfessionals.push({ id: docSnap.id, ...data });
                    }
                });
                
                renderProfessionals(allProfessionals);

            } catch (error) {
                console.error("Error fetching professionals:", error);
                serviceListingsEl.innerHTML = `<div class="col-12 text-center text-danger">Failed to load marketplace data.</div>`;
            }
        }
        
        // 5. RENDERING
        function renderProfessionals(professionals) {
            serviceListingsEl.innerHTML = '';
            noResultsEl.style.display = 'none';

            if (professionals.length === 0) {
                noResultsEl.style.display = 'block';
                return;
            }

            professionals.forEach(p => {
                const col = document.createElement('div');
                col.className = 'col-lg-4 col-md-6';
                col.innerHTML = `
                    <a href="service-detail.html?id=${p.id}" class="card service-card p-3 text-decoration-none text-dark">
                        <div class="d-flex align-items-start">
                            <img src="${p.logoUrl || 'img/default-logo.png'}" alt="${p.name}" class="logo-preview-sm">
                            <div>
                                <h5 class="mb-0">${p.name}</h5>
                                <div class="small text-muted">${p.city || 'Available Nationwide'}</div>
                            </div>
                        </div>
                        <p class="mt-2 small mb-1">
                            ${p.description ? p.description.substring(0, 80) + '...' : 'Specializing in various hospitality services.'}
                        </p>
                        <div class="mt-2 small fw-bold text-brown">View Profile & Book â†’</div>
                    </a>
                `;
                serviceListingsEl.appendChild(col);
            });
        }
        
        // 6. SEARCH FILTERING
        searchBox.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase().trim();
            const filtered = allProfessionals.filter(p => 
                p.name.toLowerCase().includes(searchTerm) ||
                (p.city && p.city.toLowerCase().includes(searchTerm)) ||
                (p.description && p.description.toLowerCase().includes(searchTerm))
            );
            renderProfessionals(filtered);
        });

        // Initial load
        fetchProfessionals();
        document.getElementById('year').textContent = new Date().getFullYear();
    </script>
</body>
</html>